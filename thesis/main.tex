\documentclass[
    a4paper,
    titlepage,
    headinclude,
    %footinclude,
    BCOR5mm,
    numbers=noenddot,
    cleardoublepage=empty,
    tablecaptionabove,
    fontsize=11pt,
    open=right,
    twoside,
    english,
    draft
	final
]{scrbook}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[italian,main=english]{babel}

%\usepackage[eulerchapternumbers,subfig,beramono,eulermath,pdfspacing]{classicthesis}
%\usepackage[eulerchapternumbers,subfig,eulermath,pdfspacing]{classicthesis}
%\usepackage{arsclassica}


%\usepackage{lineno}
\usepackage{showkeys}


% TODO Setup typography (fonts, mparhack, microtype...)
%\input{config/typographyConfig}
\renewcommand{\sfdefault}{iwona}

% Define some useful colors
\input{config/colorConfig}
% Setup plots
\input{config/pgfConfig}
\usepackage{subfig}
\usepackage{rotating}
\usepackage{booktabs}
% For the background coffee stain in the acknowledgements page.
\usepackage{eso-pic}

% Setup units
\input{config/siunitxConfig}
% Setup math
\input{config/mathConfig}
\newcommand{\A}{\ensuremath{\mathcal{A}}}
\newcommand{\Intensity}{\ensuremath{\mathcal{I}}}
\newcommand{\package}[1]{\textsf{#1}}
\newcommand{\ROOT}{{\footnotesize{\package{ROOT}}}}
\newcommand{\MINUIT}{{\footnotesize{\package{MINUIT}}}}
\newcommand{\cpp}[1][]{{\footnotesize{C++\ifthenelse{\equal{#1}{}}{}{#1}}}}
\newcommand{\eg}{e.g.}
\newcommand{\ie}{i.e.}

\newcommand{\collaboration}[1]{\textsc{#1}}
\newcommand{\cleo}{\collaboration{cleo}}
\newcommand{\focus}{\collaboration{focus}}

% Wrappers for the acronyms
% No plurals should be needed for packages
\newcommand{\pac}[1]{\package{\ac{#1}}}
\newcommand{\pacl}[1]{\package{\acl{#1}}}
\newcommand{\pacs}[1]{\package{\acs{#1}}}

% Setup listings
\input{config/listingsConfig}

% Setup index
\input{config/indexConfig}
% Setup bibliography
\input{config/bibliographyConfig}

% Define abstract environment for *book class
\input{config/abstractConfig}
% Define acknowledgements environment
% XXX Load _after_ abstractConfig.tex!!
\input{config/acknowledgementsConfig}

% Setup hyperref
\input{config/hyperrefConfig}
% Setup acronyms
% XXX Load it _after_ hyperref, babel, polyglossia, inputenc and fontenc
\input{config/acronymConfig}

\usepackage{caption}

% Add this package to draw molecules (needed for the caffeine!)
\usepackage{chemfig}
% Change atom font in molecule figures
\renewcommand*\printatom[1]{\ensuremath{\mathsf{#1}}}

\usepackage[
%    notitalic, % particle names are upright
]{hepnames}
\newcommand{\Pfnez}{\HepParticleResonanceFull{f}{0}{}{980}{}{}{}}
\newcommand{\Pfofzz}{\HepParticleResonanceFull{f}{0}{}{1500}{}{}{}}
\newcommand{\Pfotsz}{\HepParticleResonanceFull{f}{0}{}{1370}{}{}{}}
\newcommand{\Psigma}{\HepParticleResonanceFull{f}{0}{}{500}{}{}{}}
\usepackage{qrcode}

\title{Development of software for model-independent analysis of multi-body hadronic decays}
\subtitle{}
\author{
  \input{AUTHORS}
}
\date{}

\begin{document}
%\linenumbers


%----------------------------------------------------------------------------------------
% FRONTMATTER
%
\frontmatter
\phantomsection
\pdfbookmark[0]{Title}{chap:title}
	\maketitle
	\thispagestyle{empty}

	\cleardoublepage
\phantomsection
\pdfbookmark[0]{Dedication}{chap:dedication}
	\input{frontmatter/dedication}

	\cleardoublepage
\phantomsection
\pdfbookmark[0]{\abstractname}{chap:abstract}
	\input{frontmatter/abstract}

	\cleardoublepage
\phantomsection
\pdfbookmark[0]{Acknowledgements}{chap:acknowledgements}
	\input{frontmatter/acknowledgements}

	\cleardoublepage
\phantomsection
\pdfbookmark[0]{\contentsname}{chap:contents}
	\tableofcontents

%----------------------------------------------------------------------------------------
% MAINMATTER
%
\mainmatter

    \input{mainmatter/introduction.tex}
    \input{mainmatter/theory.tex}
    \input{mainmatter/yap.tex}
    \input{mainmatter/mipwa.tex}

    \begin{figure}
        \centering
        \includegraphics[width=.9\textwidth]{fig/f2_real_time_fit.png}

        \caption{Screenshot of the real-time plot of the decay-amplitude magnitude while fitting a \Pfii{} resonance.
                 In blue, with black points, the initial guess for the fit parameters; in red, the fit parameters.
                 In this case, the initial guess for the fit parameters is the value of the \Pfii{} dynamic shape on the low edges of the bins that partition the mass range.}
        \label{fig:rt_par_fit}
    \end{figure}


    Due to the long fit times, I decided to implement a real-time visualization tool for the fit.
    For each \lstinline!FreedWave!, the \lstinline!RTPlotMIFitModel! class will create a pair of plots for the decay-amplitude magnitude and phase.
    Each plot contains two \ROOT{} graphs: the initial guess for the fit parameters, and the values of the fit parameters updated in real time in every fit iteration.
    The figure~\ref{fig:rt_par_fit} shows a screenshot of the magnitude of the \Pfii{} decaying amplitude.
    By means of these plots, the user does not have to wait until the end of the fit just to find out there was some mistake in the model.
    Moreover, I have experienced that this is also a great debugging utility, \eg{}~for spotting mistakes in the utility routines that convert fit parameters into \pac{yap} free amplitudes. 


    \input{mainmatter/conclusions.tex}

    \begin{figure}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    xlabel = {$\Re (\Delta_{\Pfnez}^{\text{BW}}(s))$},
                    ylabel = {$\Im (\Delta_{\Pfnez}^{\text{BW}}(s))$},
                ]

                \pgfmathsetmacro{\m}{.98}
                \pgfmathsetmacro{\T}{.07}

                \addplot+ [black, mark options={mark size = .75, color=black}]
                  gnuplot [raw gnuplot] {
                    set parametric;
                    f(x) = 1. / (\m * \m - x * x - {0., 1.} * \m * \T);
                    set samples 150;
                    plot [.279:1.73] real(f(t)), imag(f(t));
                };
            \end{axis}
        \end{tikzpicture}
        \caption{Argand-Gauss plot of a non-relativistic Breit-Wigner~\eqref{eq:bw}.}
    \end{figure}

%----------------------------------------------------------------------------------------
% BACKMATTER
%
\backmatter
	% Acronyms
	\printnoidxglossaries

    % List of figures
    \cleardoublepage
    \phantomsection
    \pdfbookmark[0]{\listfigurename}{chap:lof}
	\listoffigures

	% Index
	\cleardoublepage
	\phantomsection
	\addcontentsline{toc}{chapter}{\indexname}
	\printindex

	% Bibliography
	\cleardoublepage
	\phantomsection
	\addcontentsline{toc}{chapter}{\bibname}
	\nocite{*}
	\printbibliography

\end{document}
