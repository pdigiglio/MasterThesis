%\chapter{\acl{mipwa}}
\chapter{\texorpdfstring{\Acl{mipwa}}{Model-independent PWA}}
\label{chap:model_independent_pwa}

By means of a \acf{mipwa} one can study decays whose wave resonance content is not yet well known or whose resonance shapes are not yet precisely understood.
\citeauthor{PhysRevD.73.032004}, at Fermilab, first performed a \ac{mipwa} of a heavy-meson decay to parametrize the S-wave component of the $\PKminus{}\Ppiplus{}$ system in the $\PDplus\to\PKminus\Ppiplus\Ppiplus$ decay~\cite{PhysRevD.73.032004}.
\citeauthor{Link200914}, in the \focus{} collaboration, conducted a similar study on the same hadronic decay~\cite{Link200914}.


In this chapter, I will describe a utility I coded, which implements the \ac{mipwa} formalism.
The utility is based on \pac{yap}---for the calculation of the decay amplitudes---and \pac{bat}---for the sampling of the phase space.
I will also show the result of the fits I performed on \ac{mc} data of $\PDplus\to\Ppiplus\Ppiminus\Ppiplus$ decays to test the utility.
The project is hosted on \textsf{GitHub} at \url{https://github.com/pdigiglio/ModelIndependentFit}.\marginpar{\centering\qrcode[height=2cm]{https://github.com/pdigiglio/ModelIndependentFit}\captionof*{figure}{Fit utility's \textsc{url}.}}


    \section{The fit utility}

    The \ac{mipwa} utility implements a \pac{yap} decay model in which the dynamic shape of each isobar is a piecewise function.\footnote{So far, I did not yet implement the mixed formalism with freed and fixed waves.}
    The model assigns a non-fixed free amplitude to each mass bin of the dynamic shapes.
    The non-fixed free amplitudes are then mapped to fit parameters for the \pac{bat} sampler.
    \pac{bat} queries the model likelihood, and updates the fit parameters---and, consequently, the non-fixed free amplitudes of the \pac{yap} model---until it finds a maximum of the likelihood.


    Please note that unlike chapter~\ref{chap:yap}, where I reserved the word ``parameter'' to indicate the smart variables the \lstinline!MassShape! class depends on, here I will also call ``parameter'' a fit \ac{dof}.

    \input{mainmatter/mipwa/the_decay_model.tex}
    \input{mainmatter/mipwa/the_fit_dof.tex}
    \include{mainmatter/mipwa/fit_likelihood}

    \section{Fits}

    In this section I present the fits I performed by means of the utility described above.
    I generated the data to fit the model to using \pac{bat} as a \ac{mc} engine, and \pac{yap} as an amplitude calculator.
    Listing~\ref{lst:partial_cleo_decay} shows how to set up a \lstinline!Model! instance whose decay intensity can be used as the \ac{mc} sampling distribution to generate the data.


    During the fit I have noticed that the convergence takes longer for the phase-difference parameters than for the magnitude parameters to be reached.

    {\color{red}
    Moreover, \pac{bat} cannot properly handle the phase periodicity so the phase-space sampling becomes inefficient.
    To get rid of the sign ambiguity in the phase, I have chosen the fit parameters to be the magnitude of the bin free amplitudes and the phase difference between each bin's free amplidude and the previous bin's one.
    Namely the fit parameters are $P_i = (\rho_i, \uD\phi_i)$, where $\rho_i$ is the free-amplitude magnitude of the $i$-th bin, $\abs{A_i}$, and $\uD\phi_i = \phi_i - \phi_{i-1}$ is the difference between two adjacent bin's free-amplitude phases. 
    The phase ambiguity is removed by enforcing each fit parameter $\uD\phi_i$ to be non-negative.
    Note that by convention the first phase difference is set to zero:
    \begin{equation}\label{eq:delta_phi_zero_cond}
        \uD\phi_0 \coloneqq 0.
    \end{equation}
    }


    \input{mainmatter/mipwa/single_resonance_fits.tex}
    \input{mainmatter/mipwa/single_wave_fits.tex}
    \input{mainmatter/mipwa/multiple_wave_fits.tex}


    The determination of the phase motion is much easier for the S wave than it is for other waves, due to their non-trivial angular dependency.


    The same holds for the P-wave \Prhozero{} fit.


    \section{Future enhancements}
    

    \begin{itemize}
        \item 
            Bins with small number of events are ambiguous. 
            An improvement to my fit utility is to implement an adaptive-binning algorithm, which automatically selects the bin extremes to have all the bins contain the same number of elements.
            This has been done manually in the fits above.

        \item Mixed model-independent and model-dependent \ac{pwa} formalisms;

        \item Derivative of the log-likelihood for fast fit convergence.
    \end{itemize}


